<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>N‑Body Playground by Steve Cullen and ChatGPT (v1.2.2-legacy)</title>
<style>
  html, body { margin:0; height:100%; overflow:hidden; background:#0b0f16; color:#e6eef8; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
  #status { position:fixed; top:8px; left:8px; background:#0f1a2e; border:1px solid #213357; padding:6px 8px; border-radius:6px; white-space:pre; font:12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; z-index:10; }
  #metrics { position:fixed; bottom:8px; left:8px; background:#0f1a2e; border:1px solid #213357; padding:6px 8px; border-radius:6px; white-space:pre; font:12px ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; z-index:10; }
  canvas { display:block; }
  #ui { position:fixed; right:8px; top:8px; background:#0f1a2e; border:1px solid #213357; padding:8px; border-radius:8px; z-index:10; }
  #ui label { display:block; font-size:12px; margin:6px 0 2px; }
  #ui input { width:200px; }
  #ui button { margin-top:8px; width:100%; padding:6px; }
</style>
</head>
<body>
<div id="status">Booting…</div>
<div id="metrics">—</div>
<div id="ui">
  <label>Stars (N)</label>
  <input id="nStars" type="range" min="50" max="3000" step="50" value="600">
  <label>Init radius (AU)</label>
  <input id="radiusAU" type="range" min="0.2" max="30" step="0.1" value="5">
  <label>Init velocity (km/s)</label>
  <input id="initV" type="range" min="0" max="60" step="1" value="0">
  <label>Central mass (M☉)</label>
  <input id="mCentral" type="range" min="0.2" max="20" step="0.1" value="1">
  <button id="btnReset">Reset</button>
  <button id="btnStart">Start</button>
  <button id="btnPause">Pause</button>
</div>

<!-- UMD builds to avoid module resolution issues -->
<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.160.0/examples/js/controls/TrackballControls.js"></script>
<script>
(function() {
  const statusEl = document.getElementById('status');
  function webglInfo() {
    const canvas = document.createElement('canvas');
    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
    if (!gl) return { ok:false, msg:'WebGL not supported' };
    const dbg = gl.getExtension('WEBGL_debug_renderer_INFO') || gl.getExtension('WEBGL_debug_renderer_info');
    let vendor=null, renderer=null;
    try {
      vendor = dbg ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) : gl.getParameter(gl.VENDOR);
      renderer = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : gl.getParameter(gl.RENDERER);
    } catch(e) { vendor='n/a'; renderer='n/a'; }
    return { ok:true, msg:'WebGL OK', vendor, renderer, version: gl.getParameter(gl.VERSION) };
  }
  const boot = webglInfo();
  statusEl.textContent = boot.ok
    ? 'Booting… WebGL OK\nVendor: '+boot.vendor+'\nRenderer: '+boot.renderer+'\nVersion: '+boot.version
    : 'Booting… WebGL FAILED: '+boot.msg;
})();
</script>

<script>
// Minimal but working N-body (central mass only) — legacy build
(function() {
  const AU = 1.496e11, MSUN = 1.989e30, G = 6.67430e-11;

  const params = {
    n: 600,
    radiusAU: 5,
    initV_kms: 0,
    mCentral: 1,
    softening: 0.01
  };

  const $ = (id)=>document.getElementById(id);
  $('nStars').addEventListener('input', e=> params.n = parseInt(e.target.value,10));
  $('radiusAU').addEventListener('input', e=> params.radiusAU = parseFloat(e.target.value));
  $('initV').addEventListener('input', e=> params.initV_kms = parseFloat(e.target.value));
  $('mCentral').addEventListener('input', e=> { params.mCentral = parseFloat(e.target.value); centralMass = params.mCentral * MSUN; resizeCentral(); });

  let scene, camera, renderer, controls, central, bodies=[], running=false, lastT=0;
  let centralMass = params.mCentral * MSUN;

  // Boot scene
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0b0f16);
  camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.01, 5000);
  camera.position.set(12, 10, 18);

  renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  controls = new THREE.TrackballControls(camera, renderer.domElement);
  controls.rotateSpeed=3; controls.zoomSpeed=1.2; controls.panSpeed=0.8; controls.staticMoving=true; controls.dynamicDampingFactor=0.2;

  window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight; camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });

  // Starfield backdrop to confirm rendering
  const starsGeo = new THREE.BufferGeometry();
  const starCnt = 800;
  const starPos = new Float32Array(starCnt*3);
  for (let i=0;i<starCnt;i++) {
    const r=1000, th=Math.random()*Math.PI*2, ph=Math.acos(2*Math.random()-1);
    starPos[3*i]=r*Math.sin(ph)*Math.cos(th);
    starPos[3*i+1]=r*Math.sin(ph)*Math.sin(th);
    starPos[3*i+2]=r*Math.cos(ph);
  }
  starsGeo.setAttribute('position', new THREE.BufferAttribute(starPos,3));
  const starsMat = new THREE.PointsMaterial({ size:1.5, sizeAttenuation:true, color:0x7fa6ff });
  scene.add(new THREE.Points(starsGeo, starsMat));

  // Central star
  function centralRadiusAU(mkg) {
    const RSun=6.9634e8; const r=RSun*Math.pow(mkg/MSUN,0.8); return (r/AU)*20;
  }
  function resizeCentral() {
    const r = centralRadiusAU(centralMass);
    central.geometry.dispose();
    central.geometry = new THREE.SphereGeometry(r, 24, 18);
  }
  const cmat = new THREE.MeshBasicMaterial({ color:0xffd27a });
  central = new THREE.Mesh(new THREE.SphereGeometry(centralRadiusAU(centralMass), 24, 18), cmat);
  scene.add(central);

  // Reset / populate
  function randomPointInSphere(Rm) {
    let x,y,z; do { x=(Math.random()*2-1)*Rm; y=(Math.random()*2-1)*Rm; z=(Math.random()*2-1)*Rm; } while (x*x+y*y+z*z>Rm*Rm);
    return new THREE.Vector3(x,y,z);
  }
  function randomPerp(n) { const v=new THREE.Vector3(Math.random()-0.5,Math.random()-0.5,Math.random()-0.5); return v.cross(n).normalize(); }
  function reset() {
    // clear old
    for (const b of bodies) scene.remove(b.mesh);
    bodies.length=0;
    // populate
    const R = params.radiusAU * AU;
    for (let i=0;i<params.n;i++) {
      const pos = randomPointInSphere(R);
      const mass = 1e-4 * MSUN; // simple uniform mass for legacy demo
      const rVis = Math.max(0.002*AU, (6.9634e8/AU)*10); // ensure visible
      const mesh = new THREE.Mesh(new THREE.SphereGeometry(rVis, 12, 8), new THREE.MeshBasicMaterial({ color:0xffffff }));
      mesh.position.copy(pos.clone().divideScalar(AU));
      scene.add(mesh);
      let vel = new THREE.Vector3();
      const v0 = params.initV_kms*1000;
      if (v0!==0) { const n = pos.clone().normalize(); vel = randomPerp(n).multiplyScalar(v0); }
      bodies.push({ pos, vel, mass, mesh });
    }
    autoFit();
  }
  function autoFit() {
    const dist = Math.max(8, params.radiusAU*3);
    camera.position.set(dist, dist*0.8, dist*1.1);
    controls.target.set(0,0,0); controls.update();
  }
  reset();

  // Physics (central force only, softened)
  function step(h) {
    const eps2 = (0.01*AU)*(0.01*AU);
    for (let i=0;i<bodies.length;i++) {
      const b = bodies[i];
      const r = b.pos.length();
      const n = r>0 ? b.pos.clone().divideScalar(r) : new THREE.Vector3();
      const aMag = - G*centralMass/(r*r+eps2);
      b.vel.addScaledVector(n, aMag*h);
      b.pos.addScaledVector(b.vel, h);
      b.mesh.position.copy(b.pos.clone().divideScalar(AU));
    }
  }

  // UI buttons
  $('btnReset').addEventListener('click', reset);
  $('btnStart').addEventListener('click', ()=> running=true);
  $('btnPause').addEventListener('click', ()=> running=false);

  // Metrics
  const metricsEl = document.getElementById('metrics');
  function metrics(dt) {
    const n = bodies.length;
    const avgR = n ? bodies.reduce((s,b)=>s+b.pos.length(),0)/n : 0;
    const avgV = n ? bodies.reduce((s,b)=>s+b.vel.length(),0)/n : 0;
    metricsEl.textContent = 'Bodies: '+n+'\nCentral: '+(centralMass/MSUN).toFixed(2)+' M☉\nAvg R: '+(avgR/AU).toFixed(2)+' AU\nAvg V: '+(avgV/1000).toFixed(2)+' km/s';
  }

  // Animate
  function animate() {
    requestAnimationFrame(animate);
    const now = performance.now(); if (!lastT) lastT=now; const dt=(now-lastT)/1000; lastT=now;
    if (running) {
      const sim = dt*2000; const steps = Math.max(1, Math.ceil(sim/0.02)); const h=sim/steps;
      for (let s=0;s<steps;s++) step(h);
    }
    controls.update();
    renderer.render(scene, camera);
    metrics(dt);
  }
  animate();
})();
</script>
</body>
</html>
